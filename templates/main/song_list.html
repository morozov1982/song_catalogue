{% extends 'layout/base.html' %}
{% load static %}
{% load main_tags %}

{% block title %}Главная{% endblock %}

{% block content %}
    {% get_last_songs count=5 %}

    <form action="{% url 'main:filter' %}" method="get">
        <div>
            <h3 class="mt-4">Годы</h3>
            {% for song in view.get_years %}
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="year" value="{{ song.year }}"
                           id="year{{ forloop.counter }}">
                    <label class="form-check-label" for="year{{ forloop.counter }}">
                        {{ song.year }}
                    </label>
                </div>
            {% endfor %}
            <button type="submit" class="btn btn-primary btn-sm me-2">Отфильтровать
                <i class="bi bi-funnel fs-6"></i>
            </button>
            <a class="btn btn-secondary btn-sm" href="{% url 'main:index' %}">Сбросить фильтр
                <i class="bi bi-x-square fs-6"></i>
            </a>

        </div>
    </form>

    <h1 class="mt-5">Каталог песен (всего: {{ song_list.all.count }})</h1>

    <table class="table table-striped table-hover">
        <thead>
        <tr>
            <th scope="col">№</th>
            <th scope="col">Песня</th>
            <th scope="col">Исполнители</th>
            <th scope="col">Ссылки</th>
        </tr>
        </thead>
        <tbody>
        {% for song in song_list %}
            <tr>
                <th scope="row">{{ forloop.counter }}</th>
                <td>
                    <a href="{{ song.get_absolute_url }}">
                        <strong>{{ song.title }}</strong>
                    </a>
                </td>
                <td>
                    {% if song.performer_order %}
                        {% for performer_id in song.performer_order %}
                            {% for performer in song.performers.all %}{% if forloop.counter == performer_id %}
                                <a href="{{ performer.get_absolute_url }}">{{ performer.nick_name }}</a>
                            {% endif %}{% endfor %}{% if not forloop.last %},
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        {% for performer in song.performers.all %}
                            <a href="{{ performer.get_absolute_url }}">{{ performer.nick_name }}</a>
                            {% if not forloop.last %},{% endif %}
                        {% endfor %}
                    {% endif %}
                </td>
                <td>
                    {% for link in song.links.all %}
                        <a href="{{ link.url }}" target="_blank">
                        {% with ld=link.description|lower|default:'' %}
                            {% if ld == 'youtube' %}
                                <i class="bi bi-youtube fs-6"></i>{% elif ld in '["vk", "ya", "yandex"]' %}
                                <i class="bi bi-play-circle-fill"></i>
                            {% else %}
                                {{ link.description }}
                            {% endif %}{% endwith %}</a>{% if not forloop.last %},{% endif %}
                    {% endfor %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}